<!DOCTYPE html>
<html>
<head>
  <title>Solana Coin Flip</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #141e30, #000000);
      color: white;
      text-align: center;
    }

    .container {
      margin-top: 60px;
    }

    .card {
      background: rgba(255,255,255,0.05);
      padding: 40px;
      border-radius: 20px;
      width: 420px;
      margin: auto;
      box-shadow: 0 0 50px rgba(0,255,255,0.3);
      backdrop-filter: blur(10px);
    }

    h1 {
      margin-bottom: 10px;
    }

    .wallet {
      font-size: 14px;
      margin-bottom: 15px;
      color: #00ffd5;
    }

    button {
      background: linear-gradient(45deg, #00c6ff, #0072ff);
      border: none;
      padding: 12px 20px;
      margin: 8px;
      border-radius: 12px;
      font-size: 16px;
      color: white;
      cursor: pointer;
      transition: 0.2s ease;
    }

    button:hover {
      transform: scale(1.05);
    }

    .choice-buttons button.active {
      background: #00ffae;
      color: black;
    }

    input {
      width: 120px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      text-align: center;
      font-size: 16px;
      margin: 10px 0;
    }

    .coin-container {
      perspective: 1000px;
      margin: 30px auto;
      width: 120px;
      height: 120px;
    }

    .coin {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1.8s ease-in-out;
    }

    .face {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
      backface-visibility: hidden;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.4);
    }

    .heads {
      background: gold;
    }

    .tails {
      background: silver;
      transform: rotateY(180deg);
    }

    .result {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
    }

    .warning {
      font-size: 12px;
      color: #ff6b6b;
    }
  </style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1>ðŸª™ Solana Coin Flip</h1>

    <div class="wallet" id="walletDisplay">Not connected</div>
    <button onclick="connectWallet()">Connect Phantom</button>

    <div class="coin-container">
      <div class="coin" id="coin">
        <div class="face heads">H</div>
        <div class="face tails">T</div>
      </div>
    </div>

    <div class="choice-buttons">
      <button onclick="selectChoice('heads')" id="headsBtn">Heads</button>
      <button onclick="selectChoice('tails')" id="tailsBtn">Tails</button>
    </div>

    <div>
      <label>Bet Amount (Max 8 SOL)</label><br>
      <input type="number" id="betAmount" min="0.01" max="8" step="0.01" value="0.1">
      <div class="warning" id="warning"></div>
    </div>

    <button onclick="flipCoin()">FLIP COIN</button>

    <div class="result" id="result"></div>
  </div>
</div>

<script>
  const connection = new solanaWeb3.Connection("https://api.devnet.solana.com");
  const TREASURY = new solanaWeb3.PublicKey("23BGxPV6Q4SXBd51xs5pvWAZ2k3MPGxyPJjHinKc3f5S");
  const WIN_PERCENTAGE = 0.44;

  let wallet = null;
  let flipping = false;
  let playerChoice = "heads";

  function selectChoice(choice) {
    playerChoice = choice;
    document.getElementById("headsBtn").classList.remove("active");
    document.getElementById("tailsBtn").classList.remove("active");
    document.getElementById(choice + "Btn").classList.add("active");
  }

  async function connectWallet() {
    if (!window.solana) {
      alert("Install Phantom Wallet");
      return;
    }

    const response = await window.solana.connect();
    wallet = response.publicKey;

    document.getElementById("walletDisplay").innerText =
      "Connected: " +
      wallet.toString().slice(0,6) +
      "..." +
      wallet.toString().slice(-4);
  }

  async function flipCoin() {
    if (!wallet || flipping) return;

    const bet = parseFloat(document.getElementById("betAmount").value);

    if (bet <= 0 || bet > 8) {
      document.getElementById("warning").innerText =
        "Bet must be between 0.01 and 8 SOL.";
      return;
    }

    document.getElementById("warning").innerText = "";
    flipping = true;
    document.getElementById("result").innerText = "Processing...";

    try {
      const transaction = new solanaWeb3.Transaction().add(
        solanaWeb3.SystemProgram.transfer({
          fromPubkey: wallet,
          toPubkey: TREASURY,
          lamports: bet * solanaWeb3.LAMPORTS_PER_SOL,
        })
      );

      transaction.feePayer = wallet;
      transaction.recentBlockhash =
        (await connection.getLatestBlockhash()).blockhash;

      const signed = await window.solana.signTransaction(transaction);
      await connection.sendRawTransaction(signed.serialize());

      const actualResult = Math.random() < WIN_PERCENTAGE ? "heads" : "tails";
      const win = playerChoice === actualResult;

      const coin = document.getElementById("coin");
      const spins = 6;
      const finalRotation = actualResult === "tails" ? 180 : 0;

      coin.style.transform =
        `rotateY(${spins * 360 + finalRotation}deg)`;

      setTimeout(() => {
        document.getElementById("result").innerText =
          win
            ? `ðŸŽ‰ YOU WON! Payout: ${bet * 2} SOL (simulated)`
            : `ðŸ˜¢ You lost ${bet} SOL`;

        flipping = false;
      }, 1800);

    } catch (error) {
      console.error(error);
      document.getElementById("result").innerText = "Transaction failed.";
      flipping = false;
    }
  }

  selectChoice("heads");
</script>

</body>
</html>
